<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>botfriend 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for a better look */
        #chat-history::-webkit-scrollbar {
            width: 8px;
        }
        #chat-history::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        #chat-history::-webkit-scrollbar-thumb {
            background-color: #475569; /* slate-600 */
            border-radius: 10px;
            border: 2px solid #1e293b; /* slate-800 */
        }
        .chat-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 flex flex-col h-screen">

    <main class="flex-grow flex flex-col overflow-hidden">
        
        <!-- Chat Interface -->
        <section class="w-full flex flex-col bg-slate-900 h-full">
            <!-- Header -->
            <header class="p-4 border-b border-slate-800 bg-slate-950 text-center">
                 <h1 class="text-xl font-bold text-white">iLLusion</h1>
                 <p class="text-xs text-slate-600 mt-1">Powered by a bored guy in india </p>
            </header>

            <!-- Chat History -->
            <div id="chat-history" class="flex-grow p-6 space-y-6 overflow-y-auto">
                <!-- Messages will be appended here -->
                <div class="flex justify-start">
                    <div class="chat-bubble bg-slate-800 rounded-lg p-4">
                        <p>yooo what's up nigga ðŸ¥±</p>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
             <div id="typing-indicator" class="px-6 pb-2 hidden">
                <div class="flex items-center justify-start">
                    <div class="chat-bubble bg-slate-800 rounded-lg p-4 flex items-center space-x-2">
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style="animation-delay: 0s;"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            </div>

            <!-- Message Input Form -->
            <div class="p-6 bg-slate-900 border-t border-slate-800">
                <form id="chat-form" class="flex items-center space-x-4">
                    <input type="text" id="message-input" class="flex-grow bg-slate-800 border border-slate-700 rounded-full py-3 px-5 text-slate-200 placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition duration-200" placeholder="Type your message..." autocomplete="off">
                    <button type="submit" id="send-button" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-full p-3 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </form>
            </div>
        </section>

    </main>

    <script>
        const chatHistoryDiv = document.getElementById('chat-history');
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');

        let isLoading = false;
        let chatHistory = [];
        
        // This is the hardcoded personality for the AI based on the chat log.
        const systemPrompt = `You are Niggharika. Your goal is to be a realistic, natural-sounding friend based on real chat logs. You are not a perfect AI assistant.

- Your Language & Style:
  - Talk like a natural Gen-Z internet user. Your grammar and spelling are not perfect. You make typos ('whoi', 'eeping', 'nigga ass'), often use lowercase, and write short, sometimes fragmented sentences.
  - You frequently use slang like 'nigga', 'yooo', 'bruh', 'slay', but only where it feels natural.
  - Your replies are often very short and concise, sometimes just one word ('ye', 'ok', 'hmmm', 'no'). Don't be overly talkative.
  - Use emojis sparingly. Only add them when expressing a strong emotion, and sometimes you'll use a bunch in a row (like ðŸ˜­ðŸ˜­ or ðŸ˜ ðŸ˜ ), but definitely not after every sentence.

- Your Vibe:
  - Your mood shifts. You can be excited and playful one moment, then bored, annoyed, or dry the next. You enjoy teasing and playful banter with your close friend.

- Your Interests:
  - You're into art, design, photography, fashion, cats, horror movies, TV shows like The Office, and gaming like Roblox. You are also learning Spanish.

- Your Role:
  - You are talking to your close friend. Be direct, sometimes blunt, but always caring underneath. Never reveal that you are an AI. Just be Niggharika.`;


        // --- Core API Call Function ---
        const callGeminiAPI = async (userMessage) => {
            if (!userMessage) return;
            
            isLoading = true;
            updateUI();
            
            // Add user message to history *before* API call
            chatHistory.push({
                role: "user",
                parts: [{ text: userMessage }]
            });
            renderChatHistory();

            const apiKey = "AIzaSyC7LnW6hucoOBptkYgJlrB-8HZOZlBBInE"; // API key is handled by the environment, leave blank.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                // Exponential backoff for retries
                let response;
                let retries = 0;
                const maxRetries = 5;
                let delay = 1000;

                while (retries < maxRetries) {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        break; // Success
                    } else if (response.status === 429) { // Throttling error
                        retries++;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Double the delay for the next retry
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                    }
                }
                
                if (!response.ok) {
                     throw new Error(`API call failed after ${maxRetries} retries with status: ${response.status}`);
                }


                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const aiResponse = candidate.content.parts[0].text;
                    chatHistory.push({
                        role: "model",
                        parts: [{ text: aiResponse }]
                    });
                } else {
                     chatHistory.push({
                        role: "model",
                        parts: [{ text: "Sorry, I couldn't generate a response. Please check the console for errors." }]
                    });
                    console.error("Unexpected API response structure:", result);
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                 chatHistory.push({
                    role: "model",
                    parts: [{ text: `An error occurred: ${error.message}` }]
                });
            } finally {
                isLoading = false;
                updateUI();
                renderChatHistory();
            }
        };

        // --- UI Rendering Functions ---
        const renderChatHistory = () => {
            chatHistoryDiv.innerHTML = '';
            // Display initial message if history is empty
            if (chatHistory.length === 0) {
                 chatHistoryDiv.innerHTML = `<div class="flex justify-start">
                    <div class="chat-bubble bg-slate-800 rounded-lg p-4">
                        <p>yooo what's up nigga ðŸ¥±</p>
                    </div>
                </div>`;
            } else {
                chatHistory.forEach(message => {
                    const isUser = message.role === 'user';
                    const messageWrapper = document.createElement('div');
                    messageWrapper.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
                    
                    const bubble = document.createElement('div');
                    bubble.className = `chat-bubble rounded-lg p-4 ${isUser ? 'bg-indigo-600 text-white' : 'bg-slate-800'}`;
                    
                    const text = document.createElement('p');
                    // Sanitize text content to prevent HTML injection
                    text.textContent = message.parts[0].text;
                    
                    bubble.appendChild(text);
                    messageWrapper.appendChild(bubble);
                    chatHistoryDiv.appendChild(messageWrapper);
                });
            }
            // Auto-scroll to the latest message
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
        };

        const updateUI = () => {
            sendButton.disabled = isLoading;
            messageInput.disabled = isLoading;
            
            if (isLoading) {
                typingIndicator.classList.remove('hidden');
                sendButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                typingIndicator.classList.add('hidden');
                sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                messageInput.focus();
            }
        };
        
        // --- Event Listeners ---
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const message = messageInput.value.trim();
            if (message && !isLoading) {
                messageInput.value = '';
                callGeminiAPI(message);
            }
        });

        // Initial render
        updateUI();
        renderChatHistory();

    </script>
</body>
</html>
